# База Знаний: Создание Иллюстрированной Новеллы с AI

Этот файл содержит накопленный опыт работы над проектом "Комиксы Ивана" — практики, советы и решения проблем при создании книги с AI-генерацией изображений.

---

## 1. Структура Рабочего Процесса

### Порядок создания страницы:
1. **Сюжет** — обсуждение идей, создание синопсиса главы
2. **Сценарий** — написание текста для левой страницы
3. **Промпт** — составление детального промпта для иллюстрации
4. **Генерация** — создание изображения в AI-сервисе
5. **Итерация** — корректировка промпта при необходимости
6. **Финализация** — сохранение финального изображения

### Структура файлов страницы:
```
/Глава XX/Страница XX/
├── сценарий.md    # Текст + промпт
└── render.png     # Финальное изображение
```

---

## 2. Консистентность Персонажей

### Главная проблема
AI-модели не могут идеально повторять одного персонажа между изображениями. Каждая генерация — это новая интерпретация.

### Решения:

#### A. Мастер-токены персонажей
Создать детальное текстовое описание каждого персонажа и **копировать его полностью** в каждый промпт без изменений.

**Пример структуры токена:**
```
[Имя], [возраст/тип], [волосы: цвет + стиль], [глаза: цвет + важность], [выражение лица], [кожа], [одежда детально], [ключевые предметы]
```

#### B. Важные пометки в токенах
Если AI часто ошибается в какой-то детали, добавлять явные указания:
- `warm brown eyes (important: brown not blue)` — когда AI путает цвет глаз
- `no beard (important: clean chin, no roots hanging down)` — когда нужно убрать нежелательный элемент

#### C. Токены для артефактов/оружия
Важные предметы тоже требуют отдельных детальных токенов для консистентности.

---

## 3. Работа с DALL-E (ChatGPT)

### Особенности модели:
- Хорошо понимает естественный язык
- Можно использовать длинные детальные промпты
- Понимает композиционные указания (split screen, close-up, etc.)
- Обращает внимание на пометки типа "(important: ...)"

### Структура промпта для DALL-E:
```
[СТИЛЬ], [КАЧЕСТВО], [ОГРАНИЧЕНИЯ],

[КОМПОЗИЦИЯ],

[ПЕРСОНАЖ 1: полный токен + действие],

[ПЕРСОНАЖ 2: полный токен + действие],

[АТМОСФЕРА, ОСВЕЩЕНИЕ, ЭФФЕКТЫ]
```

### Inpainting (редактирование области):
- ✅ Использовать для: мелких исправлений фона, удаления артефактов
- ❌ Не использовать для: лиц, поз, одежды персонажей — может сломать консистентность
- **Рекомендация**: для персонажей лучше генерировать заново с улучшенным промптом

---

## 4. Частые Проблемы и Решения

### Проблема: Неправильный цвет глаз
**Решение**: Добавить `(important: [цвет] not [неправильный цвет])` в токен персонажа.

### Проблема: Лишние элементы (борода, лишние детали)
**Решение**: Явно указать отсутствие: `no beard`, `clean chin`, `no roots hanging from jaw`.

### Проблема: Неестественная поза с оружием
**Решение**: Описать позу анатомически точно:
```
holding a bow in proper archery stance (bow held vertically in left hand, right hand pulling the glowing string back near her cheek)
```

### Проблема: Оружие/предмет выглядит по-разному
**Решение**: Создать детальный токен предмета с описанием формы, материала, деталей:
```
magical golden-bronze ornate bow with elegant spiral curls on both ends, celtic-style decorative swirls, glowing golden energy bowstring
```

### Проблема: Персонаж выглядит как другой человек
**Решение**:
1. Использовать референсное изображение из ранних глав
2. Добавить больше уникальных деталей в токен
3. Указывать стиль одежды максимально точно

---

## 5. Стилистические Константы

### Базовый стиль проекта:
```
modern anime style, studio ghibli inspired but with 3D volume, vibrant colors, volumetric lighting, cinematic atmosphere, 8k, masterpiece, child-friendly PG rating, NO TEXT NO WORDS
```

### Формат проекта:
- Иллюстрированная новелла (не комикс с панелями)
- Левая страница: текст
- Правая страница: одно полностраничное изображение
- Целевая аудитория: дети ~10 лет, рейтинг PG

---

## 6. Токены Персонажей (Актуальные)

### Джоана (обновлено)
```
Joana, young woman photographer, early 20s, medium-length chestnut brown hair tied back in a low ponytail, warm brown eyes (important: brown not blue), cheerful expressive face, slightly tanned skin, wearing a beige multi-pocket safari vest over a cream-white long-sleeve shirt with rolled-up sleeves, olive green cargo pants, brown hiking boots, brown backpack
```

### Лук Джоаны (обновлено)
```
magical golden-bronze ornate bow with elegant spiral curls on both ends, celtic-style decorative swirls, glowing golden energy bowstring (not physical string), glowing golden energy arrow, golden sparkles and particles floating around the bow, no physical arrows or quiver
```

### Тобиас (обновлено)
```
Tobias the ancient forest god, colossal humanoid creature made entirely of twisted dark brown roots vines and gnarled bark, body covered with patches of green moss, massive powerful muscular body structure, face made of bark with no beard (important: clean chin, no roots or vines hanging from chin or jaw), head with branch-like antlers growing upward only, two glowing bright white-blue ethereal eyes like magical lights, menacing intimidating stance
```

---

## 7. Идеи для Будущего Приложения

### Функциональность:
- [ ] Библиотека токенов персонажей с версионированием
- [ ] Конструктор промптов из блоков (стиль + персонаж + сцена + атмосфера)
- [ ] Галерея референсов для каждого персонажа
- [ ] История генераций с привязкой к промптам
- [ ] A/B тестирование промптов
- [ ] Автоматическая сборка PDF из глав

### Данные для сбора:
- Какие формулировки работают лучше
- Частые ошибки AI и их решения
- Статистика итераций до успешного результата

---

## 8. Лог Изменений

### 2026-01-30
- Создана база знаний
- Обновлены токены: Джоана (глаза), Лук (детали дизайна), Тобиас (без бороды)
- Добавлено описание позы для стрельбы из лука
- Начата работа над Главой 2, Страница 04

---

*Этот файл обновляется по мере накопления опыта.*
